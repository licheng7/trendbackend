<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.arp.trend.repository.biz.manual.IcComeManualMapper" >
  <resultMap id="BaseResultMap" type="cn.arp.trend.entity.biz.IcCome" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="jgmc" property="jgmc" jdbcType="VARCHAR" />
    <result column="jgbh" property="jgbh" jdbcType="VARCHAR" />
    <result column="field" property="field" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="gender" property="gender" jdbcType="VARCHAR" />
    <result column="birthday" property="birthday" jdbcType="VARCHAR" />
    <result column="nationality" property="nationality" jdbcType="VARCHAR" />
    <result column="country" property="country" jdbcType="VARCHAR" />
    <result column="ydyl" property="ydyl" jdbcType="VARCHAR" />
    <result column="form" property="form" jdbcType="VARCHAR" />
    <result column="visit_date" property="visitDate" jdbcType="VARCHAR" />
    <result column="number_of_team" property="numberOfTeam" jdbcType="INTEGER" />
    <result column="subject" property="subject" jdbcType="VARCHAR" />
  </resultMap>
  <resultMap id="RankMap" type="cn.arp.trend.entity.biz.Rank">
    <result column="jgmc" property="jgmc" jdbcType="VARCHAR" />
    <result column="country" property="country" jdbcType="VARCHAR" />
    <result column="ydyl" property="ydyl" jdbcType="VARCHAR" />
    <result column="number_of_team" property="numberOfTeam" jdbcType="INTEGER" />
    <result column="visit_date" property="visitDate" jdbcType="VARCHAR" />
  </resultMap>
  <resultMap id="UnitMap" type="cn.arp.trend.entity.biz.Unit">
    <result column="jgmc" property="jgmc" jdbcType="VARCHAR" />
    <result column="num" property="num" jdbcType="INTEGER" />
  </resultMap>
  <resultMap id="CountryMap" type="cn.arp.trend.entity.biz.Country">
    <result column="country" property="country" jdbcType="VARCHAR" />
    <result column="num" property="num" jdbcType="INTEGER" />
  </resultMap>
  <resultMap id="GoAndComeLinkMap" type="cn.arp.trend.entity.biz.GoAndComeLink">
    <result column="visit_date" property="date" jdbcType="VARCHAR" />
    <result column="num" property="num" jdbcType="INTEGER" />
    <result column="country" property="country" jdbcType="VARCHAR" />
    <result column="city" property="city" jdbcType="VARCHAR" />
  </resultMap>
  <resultMap id="CountryAndNationalityMap" type="cn.arp.trend.entity.biz.CountryAndNationality">
    <result column="visit_date" property="date" jdbcType="VARCHAR" />
    <result column="country" property="country" jdbcType="VARCHAR" />
    <result column="nationality" property="country" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, jgmc, jgbh, field, name, gender, birthday, nationality, country, ydyl, form, 
    visit_date, number_of_team, subject
  </sql>

  <select id="queryCountry" resultType="java.lang.String">
    SELECT
      DISTINCT country
    FROM
      ic_come
    <where>
      country is not null
    </where>
  </select>

  <select id="queryNationality" resultType="java.lang.String">
    SELECT
      DISTINCT nationality
    FROM
      ic_come
    <where>
      nationality is not null
    </where>
  </select>

  <select id="queryForm" resultType="java.lang.String">
    SELECT
      DISTINCT form
    FROM
      ic_come
    <where>
      form is not null
    </where>
  </select>

  <select id="queryAgeYear" resultType="java.lang.String">
    SELECT
      DISTINCT ANY_VALUE(LEFT(birthday, 4)) as ageYear
    FROM
      ic_come
    <where>
      birthday is not null
    </where>
  </select>

  <select id="queryRank" resultMap="RankMap">
    select
      a.jgmc AS jgmc, country, ydyl, number_of_team, visit_date
    from
      ic_come AS a,ref_org_type AS b
    <where>
      a.jgmc=b.jgmc
      and a.country is not NULL
    </where>
    ORDER BY
      visit_date
  </select>

  <select id="queryComeUnit" resultMap="UnitMap">
    select
      a.jgmc AS jgmc, COUNT(*) AS num
    from
      ic_come AS a, ref_org_type AS B
    <where>
      a.jgmc = B.jgmc
    </where>
    GROUP BY
      jgmc
    ORDER BY
      num DESC
  </select>

  <select id="queryComeCountry" resultMap="CountryMap">
    select
      a.country AS country, COUNT(*) AS num
    from
      ic_come AS a, ref_org_type AS B
    <where>
      a.jgmc =B.jgmc AND a.country is not NULL
    </where>
    GROUP BY
      country
    ORDER BY
      num DESC
  </select>

  <select id="queryComeLink" resultMap="GoAndComeLinkMap">
    SELECT
      ANY_VALUE(LEFT(a.visit_date, 7)) AS visit_date,
      SUM(a.number_of_team) AS num,
      ANY_VALUE(a.country) AS country,
      ANY_VALUE(LEFT(b.ssfy, 2)) AS city
    FROM
      ic_come AS a,ref_org_type AS b
    <where>
      a.country is not null
      AND a.jgbh = b.jgbh
    </where>
    GROUP BY
      LEFT(a.visit_date, 7), a.country, b.ssfy
  </select>
  
  <select id="queryDistinctCountry" resultType="java.lang.String">
    SELECT
      DISTINCT country
    FROM
      ic_come
    WHERE
      country is not null
    UNION
    SELECT
      DISTINCT country
    FROM
      ic_go
    WHERE
      country is not null
    ORDER BY
      country
  </select>

  <select id="queryCountryAndNationality" resultMap="CountryAndNationalityMap">
    SELECT
      ANY_VALUE(LEFT(a.visit_date, 7)) AS visit_date,
      ANY_VALUE(a.country) AS country,
      ANY_VALUE(a.nationality) AS nationality
    FROM
      ic_come AS a
    WHERE
      a.country is not null
      AND a.nationality is not null
  </select>
</mapper>